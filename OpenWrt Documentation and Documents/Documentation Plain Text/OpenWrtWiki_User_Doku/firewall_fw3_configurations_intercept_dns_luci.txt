====== DNS hijacking using LuCI ======
See also: [[docs:guide-user:firewall:fw3_configurations:intercept_dns|DNS hijacking using CLI]]

If you have set a custom DNS server and would like to enforce this across your network without clients being able to override it, then you'll need to force all DNS traffic through the router on the default port '53'.

Many Android devices are now being pre-programmed with the Google DNS servers (8.8.8.8 and 8.8.4.4) so they automatically bypass the DNS set on the router.
It's unclear if any other devices are following this trend Android has, but if it's important that your client device(s) require a specific DNS then this guide will show you how to get around that.

A reason why you'd want to force all clients to a single DNS is if you have content filtering from a service such as OpenDNS that can block domains via URL's or through category filtering.
OpenDNS can be setup with the [[docs:guide-user:base-system:ddns|DDNS Client]] using [[https://www.dnsomatic.com|DNS-O-Matic]] When your WAN IP address updates it will also update OpenDNS so that your content filtering and URL blocking stay up-to-date.

To add this through the LuCI web interface:

  - Go to 'Network > Firewall'
  - Under the 'Port Forwards' tab enter 'Force DNS' under 'New port forward' section 
  - Set the 'Protocol to TCP+UDP
  - Set 'External zone' to 'WAN' *
  - Set 'External port' to '53' 
  - Set 'Internal zone' to 'lan' *
  - Set 'Internal port' to '53'
  - Click the 'Add' button
  - Once it's added to the list open it back up by clicking the 'Edit' button
  - Change the 'Source zone' from 'wan' to 'lan'
  - Click the 'Save & Apply' button

* If you're unable to set the exact zones simply select anything from the list as you can change it in step 10

{{https://farm8.staticflickr.com/7877/40513563233_22306e5912_b.jpg}}

{{https://farm8.staticflickr.com/7907/46564411775_13936873e9_b.jpg}}
 
{{https://farm8.staticflickr.com/7922/47479776681_d8638200ed_b.jpg}}

{{https://farm8.staticflickr.com/7803/46564411705_74da3fd639_b.jpg}}

{{https://i.postimg.cc/7YDR38nz/fixeddns.png}}

{{https://i.postimg.cc/vm6XR3vM/fixdns2.png}}

Validating redirection

The OARC Reply size Test can validate that your DNS queries are being intercepted.

[[https://www.dns-oarc.net/oarc/services/replysizetest]]

dig +short rs.dns-oarc.net TXT @8.8.8.8

{{https://i.postimg.cc/GtBmzTCM/oarc.png}}
