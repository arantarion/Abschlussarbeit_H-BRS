====== Instalando o OpenWrt ======
A instalação do OpenWrt é específica do dispositivo. 
Estes procedimentos específicos do dispositivo devem ser encontrados no wiki. Consulte [[pt-br:toh:start|Tabela de Hardware]] para obter os procedimentos disponíveis. Se o seu dispositivo não estiver listado, as informações neste Howto podem ser úteis. /*Definitivamente, dê uma olhada no [[docs:techref:flash.layout]]*/.

{{page>meta:infobox:dangerous&noheader&nofooter&noeditbtn}}

:!: Se sua tentativa de instalar o OpenWrt falhar, consulte [[docs:guide-user:Troubleshooting:generic.debrick]] para correções.

:!: Este HOWTO é MUITO genérico. Você não pode usá-lo na maioria das situações, pois precisa adaptar valores e outras peças para hardware específico. Por favor, consulte a [[:pt-br:toh:start| página de hardware suportada]] para obter a documentação específica do dispositivo.

Na maioria das situações; você tem três opções:
  * **''Option 1:''** instale o OpenWrt na memória não volátil do roteador
  * **''Option 2:''** instale o OpenWrt na RAM
  * **''Option 3:''** inicialize o OpenWrt pela rede ([[inbox:howto:netboot|netbooting]] não é suportado por todos [[docs:techref:bootloader|bootloaders]]).
===== Quatro métodos de instalação =====
Existem quatro maneiras de instalar o OpenWrt em um dispositivo:

==== Método 1: via firmware OEM ====
Abra a WebUI do **firmware OEM** com seu navegador da Web e instale o arquivo de imagem de firmware OpenWrt **factory** usando a opção //"Atualização de firmware"//. Seu dispositivo deve reiniciar com o OpenWrt instalado.

**''NOTA:''** Às vezes, o firmware OEM permite que você atualize seu dispositivo com um arquivo de firmware específico. Se for esse o caso, você não poderá instalar o OpenWrt usando esse método. No entanto, para alguns dispositivos, os bots de compilação preparam compilações marcadas, de forma que sejam compatíveis com os firmwares do fabricante. Isso deve estar documentado na página específica do dispositivo para o seu modelo.

==== Método 2: via Bootloader e uma porta Ethernet ====
A maioria, se não todos os [[docs:techref:bootloader|bootloaders]] fornece uma funcionalidade interna para esse fim. Alguns usam um [[wp>Trivial File Transfer Protocol|Cliente TFTP]], outros um servidor TFTP, outros um [[wp>File Transfer Protocol|Cliente FTP]], alguns servidores FTP, outros servidores Web e outros usam o protocolo [[wp>XMODEM]]

Antes de continuar, você precisa determinar o seguinte:

  * o endereço IP predefinido do gerenciador de inicialização (não necessariamente idêntico ao endereço IP que o dispositivo possui depois de inicializar o firmware original!)
  * o protocolo e se o carregador de inicialização age como cliente ou servidor
  * o número da porta correto ([[wp> List of TCP and UDP port numbers|padrão]])
  * a interface à qual você precisa se conectar
  * um nome de usuário e senha de login (se necessário)
  * a janela de tempo que você tem após iniciar o dispositivo para obter uma conexão. 
Depois de conhecer todos os parâmetros acima, você pode prosseguir.
  - Instale o software apropriado no seu PC (ou seja, se o carregador de inicialização usar um servidor FTP, você precisará de um cliente FTP).
  - Leia a página de manual apropriada, ou seja: ''[[http://linux.die.net/man/1/tftp|tftp]]'', ''[[http://linux.die.net/man/8/tftpd|tftpd]]'', ''[[http://linux.die.net/man/1/ftp|ftp]]'', ''[[http://linux.die.net/man/1/ncftp|ncftp]]'', ''[[http://linux.die.net/man/8/ftpd|ftpd]]'', ''[[http://linux.die.net/man/8/pure-ftpd|pure-ftpd]]'', etc ...
  - Configure um endereço IP estático para a interface do seu PC no mesmo bloco de endereços IP pré-configurado no carregador de inicialização.
  - Conecte seu PC ao dispositivo.
  - Desligue e ligue o dispositivo.
  - Conecte-se ao carregador de inicialização usando o software que você escolheu.
  - Instale o arquivo de firmware OpenWrt.
  - **<color red>Não substitua ou altere o gerenciador de inicialização</color>** até explicitamente instruído a fazê-lo!

**''NOTAS:''** Às vezes, até o carregador de inicialização impede que você grave um firmware não-OEM.
Se você tiver uma janela de tempo curta, a conexão entre o computador e o dispositivo precisará ser estabelecida rapidamente. Para tornar isso o mais rápido possível, você pode desativar a negociação automática no seu [[wp>Network interface controller|NIC]] e/ou [[http://support.microsoft.com/kb/239924|desativar sensor de mídia]].


=== Instruções específicas ===
  * [[docs:guide-user:installation:generic.flashing.tftp]]
  * [[docs:guide-user:installation:generic.flashing.ftp]]
  * [[docs:guide-user:installation:generic.flashing.xmodem]]

==== Método 3: via carregador de inicialização e porta serial ====
  * [[docs:guide-user:installation:generic.flashing.serial]]

==== Método 4: via JTAG ====
  * [[docs:techref:hardware:port.jtag]]

==== Instale uma imagem ramdisk na memória principal ====
Esta etapa mostra como fazer upload de uma nova imagem ramdisk para o dispositivo. O firmware existente no flash permanece inalterado! Você precisa de um cabo serial em funcionamento para fazer o upload do ramdisk.

  - selecione especificamente a opção RAMDISK para fazer com que o OpenWrt Buildroot crie uma imagem ramdisk para você fazer o upload.
  - conecte um cabo Ethernet entre o computador e uma das portas LAN (não importa qual, contanto que não seja a porta WAN) do WNDR3700.
  - conecte seu cabo serial ao conector no WNDR3700 e defina seu programa de terminal local (por exemplo, minicom) para
    * 115200 bps 8N1
    * nenhum controle de fluxo de software
    * nenhum controle de fluxo de hardware
  - defina a porta Ethernet do seu computador para usar o endereço IP ''192.168.0.10/24''
  - configure um servidor TFTP no seu computador local para responder a solicitações na interface 192.168.0.10. Verifique se a imagem do ramdisk (openwrt-ar71xx-uImage-lzma.bin) está no diretório usado pelo servidor TFTP.
  - Corrija o cabeçalho da imagem ramdisk para que seja reconhecida pelo firmware do u-Boot. Use o programa wndr3700.c publicado por *aorlinsk* nos fóruns aqui http://aorlinsk2.free.fr/openwrt/wndr3700/ e execute-o no diretório de dados do servidor TFTP. Também reproduzi o código aqui para o caso de precisar: <code bash>
./wndr3700 openwrt-ar71xx-uImage-lzma.bin openwrt-fixed.out
</code>
  - ligue a placa. Quando chegar à mensagem solicitando que você pressione qualquer tecla para interromper a sequência normal de inicialização, pressione uma tecla no console serial (ou apenas mantenha pressionada a tecla Enter da primeira inicialização até chegar a um prompt):
  - digite o seguinte no console: <code bash>
setenv ipaddr 192.168.0.1
setenv serverip 192.168.0.10
setenv bootargs 'board=WNDR3700'
tftpboot 80800000 openwrt-fixed.out
bootm
</code>(e você esquecer a parte das bootargs abaixo, a placa inicializará e parecerá normal, mas não poderá abrir nenhuma das interfaces de rede!)
  - O sistema deve inicializar!

Exemplos concretos: [[toh/netgear/wnr2000]], ...

Não se esqueça de consultar [[docs:start|Howtos básicos genéricos para OpenWrt]]


===== Checklist da instalação=====
//Este checklist não pode e não cobre completamente todas as maneiras de instalar o OpenWrt.//

  - Pré-instalação
    - ( ) Diga olá no canal [[http://webchat.freenode.net/?channels=#openwrt|openwrt]] no freenode.
    - ( ) Verifique se o roteador possui atualmente o firmware original/estoque instalado.
    - ( ) Configure o seu computador para usar o endereço IP estático.
    - ( ) Conecte-se ao roteador com fio, não com WiFi.
    - ( ) Faça sua própria pesquisa e leia todos os recursos sobre a instalação do OpenWrt no seu roteador:
      - ( ) [[https://oldwiki.archive.openwrt.org/doc/faq/before.installation|Perguntas frequentes antes da instalação]]
      - ( ) [[:pt-br:toh:start|Tabela de hardware]]
      - ( ) [[https://openwrt.org/start|Fórum OpenWrt]]
    - ( ) Imprima ou salve essas páginas para leitura offline:
      - ( ) [[http://wiki.openwrt.org/doc/howto/firstlogin|Primeiro login]]
      - ( ) [[:pt-br:docs:guide-user:troubleshooting:failsafe_and_factory_reset|À prova de falhas]]
    - ( ) (opcional) [[http://wiki.openwrt.org/doc/howto/generic.backup|Flash de backup do seu roteador]]. 
  - Instalação
    - ( ) Reinicie o roteador.
    - ( ) Baixe a imagem do OpenWrt no local apropriado.
      - ( ) No caso de [[http://wiki.openwrt.org/doc/howto/generic.sysupgrade|atualizar]] o sistema OpenWrt existente, o local apropriado é a RAM (geralmente/tmp). 
    - ( ) Verifique a soma de verificação MD5 da imagem do OpenWrt que você baixou.
    - ( ) Verifique se há pelo menos espaço de RAM livre quanto o tamanho da imagem do OpenWrt que você baixou.
  - Pós-instalação
    - ( ) Faça [[http://wiki.openwrt.org/doc/howto/firstlogin|primeiro login]] e defina a senha root.  
    - ( ) [[http://wiki.openwrt.org/doc/howto/generic.backup|Backup do Firmware do seu roteador]].
    - ( ) Sinta-se confortável com o [[:pt-br:docs:guide-user:troubleshooting:failsafe_and_factory_reset|modo à prova de falhas]].
    - ( ) [[http://wiki.openwrt.org/doc/howto/basic.config|Configure seu dispositivo]].



<hidden onHidden="Html do check list" onVisible="Clique para ver menos">
<code html>
<html>
  <head>
    <style type="text/css">
      .checklist label { display: block; }
      .lvl1 {margin-left:1em; font-weight:bold; margin-top:1em;}
      .lvl2 {margin-left:2em;}
      .lvl3 {margin-left:4em; font-style:italic;}
    </style>
  </head>
  <body>
    <form class="checklist">
      <label class="lvl1"><input type="checkbox"> Pre-Installation</label>
        <label class="lvl2"><input type="checkbox"> Say hello in <a href="http://webchat.freenode.net/?channels=#openwrt">#openwrt</a> channel at freenode.</label>
        <label class="lvl2"><input type="checkbox"> Make sure that the router has currently stock/original firmware installed.</label>
        <label class="lvl2"><input type="checkbox"> Configure your computer to use static IP address.</label>
        <label class="lvl2"><input type="checkbox"> Connect to the router with wire, not WiFi.</label>
        <label class="lvl2"><input type="checkbox"> Do your own research and read all the resources about installing OpenWrt on your router:</label>
          <label class="lvl3"><input type="checkbox"> <a href="http://wiki.openwrt.org/doc/faq/before.installation">FAQ before installation</a></label>
          <label class="lvl3"><input type="checkbox"> <a href="http://wiki.openwrt.org/toh/start">Table of Hardware</a></label>
          <label class="lvl3"><input type="checkbox"> <a href="https://forum.openwrt.org/">OpenWrt forum</a></label>
        <label class="lvl2"><input type="checkbox"> Print or save those pages for offline reading:</label>
          <label class="lvl3"><input type="checkbox"> <a href="http://wiki.openwrt.org/doc/howto/firstlogin">First login</a></label>
          <label class="lvl3"><input type="checkbox"> <a href="http://wiki.openwrt.org/doc/howto/generic.failsafe">Failsafe</a></label>
        <label class="lvl2"><input type="checkbox"> (optional) <a href="http://wiki.openwrt.org/doc/howto/generic.backup">Backup flash of your router.</a></label>
      <label class="lvl1"><input type="checkbox"> <b>Installation</b></label>
        <label class="lvl2"><input type="checkbox"> Reboot router.</label>
        <label class="lvl2"><input type="checkbox"> Download OpenWrt image in proper location.</label>
          <label class="lvl3"><input type="checkbox"> In case of <a href="http://wiki.openwrt.org/doc/howto/generic.sysupgrade">upgrading</a> existing OpenWrt system, the proper location is RAM (usually /tmp).</label>
        <label class="lvl2"><input type="checkbox"> Verify MD5 checksum of the OpenWrt image you downloaded.</label>
        <label class="lvl2"><input type="checkbox"> Make sure that there is at least as much free RAM as the size of OpenWrt image you have downloaded.</label>
      <label class="lvl1"><input type="checkbox"> <b>Post-Installation</b></label>
        <label class="lvl2"><input type="checkbox"> Do <a href="http://wiki.openwrt.org/doc/howto/firstlogin">First login</a> and set root password.</label>
        <label class="lvl2"><input type="checkbox"> <a href="http://wiki.openwrt.org/doc/howto/generic.backup">Backup flash of your router.</a></label>
        <label class="lvl2"><input type="checkbox"> Make yourself comfortable with the <a href="http://wiki.openwrt.org/doc/howto/generic.failsafe">Failsafe</a> mode.</label>
        <label class="lvl2"><input type="checkbox"> <a href="http://wiki.openwrt.org/doc/howto/basic.config">Configure your device</a></label>
    </form>
  </body>
</html>
</code></hidden>