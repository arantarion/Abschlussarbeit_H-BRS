====== Backup and restore ======
{{section>meta:infobox:howto_links#basic_skills&noheader&nofooter&noeditbutton}}

===== Introduction =====
  * This how-to describes the method for performing OpenWrt file-level backup/restore.
  * Follow [[docs:guide-quick-start:admingui_sysupgrade_keepsettings|Preserving configuration]] to determine whether to keep the settings.
  * Follow [[docs:guide-user:installation:generic.sysupgrade|Firmware upgrade]] to identify manually installed packages.
  * Follow [[docs:guide-user:installation:generic.backup|Generic backup]] for block-level backup/restore.

===== Goals =====
  * Provide an easy way to restore OpenWrt to the previous configuration state.

===== Web interface =====
==== 1. Customize and verify ====
Customize your backup configuration.
  - Navigate to **[[http://openwrt.lan/|LuCI]] -> System -> Backup / Flash Firmware -> Configuration**.
  - Add/remove files/directories and click **Submit** when done editing.
  - Click **Open list...** button to view the list files for backup.
Make sure the list contains all the files you want to save.

==== 2. Back up ====
Back up OpenWrt configuration to local PC.
  - Navigate to **[[http://openwrt.lan/|LuCI]] -> System -> Backup / Flash Firmware -> Actions: Backup**.
  - Click **Generate archive** button to download the archive.

==== 3. Restore ====
Restore previously saved OpenWrt configuration from local PC.
  - Navigate to **[[http://openwrt.lan/|LuCI]] -> System -> Backup / Flash Firmware -> Actions: Restore**.
  - Click **Choose File** button to select the archive.
  - Click **Upload archive...** button to upload the archive.

===== Command-line interface =====
OpenWrt provides [[docs:techref:sysupgrade|sysupgrade]] utility for file-level backup/restore.

==== 1. Customize and verify ====
Customize and verify your backup configuration.

<code bash>
# Add files/directories
cat << EOF >> /etc/sysupgrade.conf
/etc/sudoers
/etc/sudoers.d/
EOF

# Edit backup configuration
vi /etc/sysupgrade.conf

# Verify backup configuration
sysupgrade -l
</code>

==== 2. Back up ====
Back up OpenWrt configuration to local PC.

<code bash>
# Generate backup
umask go=
sysupgrade -b /tmp/backup-${HOSTNAME}-$(date +%F).tar.gz
ls /tmp/backup-*.tar.gz

# Download backup
scp root@openwrt.lan:/tmp/backup-*.tar.gz .
</code>

==== 3. Restore ====
Restore previously saved OpenWrt configuration from local PC.

<code bash>
# Upload backup
scp backup-*.tar.gz root@openwrt.lan:/tmp

# Restore backup
ls /tmp/backup-*.tar.gz
sysupgrade -r /tmp/backup-*.tar.gz
</code>
