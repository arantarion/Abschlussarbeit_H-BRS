====== Building MPD-full with PulseAudio ======
More information about building from source: [[docs:guide-developer:build-system:start|OpenWrt Buildroot - Usage]]

First you need to follow the HowtoBuild [[docs:guide-developer:build.mpd-full|MPD-full building from source]]

Based on the following reference: [[https://forum.openwrt.org/viewtopic.php?pid=287809#p287809| BB + MPD-full + PulseAudio, unable to build]]\\

==== 18.06.02 ====

=== The MPD Makefile ===
In your git clone directory edit the makefile ''/openwrt/feeds/packages/sound/mpd/Makefile''.

Detect the area in the Makefile involved with the full MPD installation. 
Add ''+pulseaudio-daemon'' to DEPENDS.

<code> 
  TITLE+= (full)
  DEPENDS+= +libffmpeg +libid3tag +libmms +libupnp +libshout +pulseaudio-daemon
  PROVIDES:=mpd
  VARIANT:=full
</code>  
Edit the --disable-pulse to **--enable-pulse** 

<code>
     --disable-nfs \
     --disable-openal \
     --disable-opus \
     --enable-pulse \
     --disable-sidplay \
     --disable-smbclient \
     --disable-sndfile \
</code>

Edit the EXTRA_LDFLAGS and add 
<code>
-Wl,-rpath-link=$(STAGING_DIR)/usr/lib/pulseaudio 
</code>
The complete line looks like that:
<code>
  EXTRA_LDFLAGS += $(if $(ICONV_FULL),-liconv,-Wl,--whole-archive -liconv -Wl,--no-whole-archive) -Wl,-rpath-link=$(STAGING_DIR)/usr/lib/pulseaudio
</code> 

Maybe the path has to be adapted to $(STAGING_DIR)/opt/lib/pulseaudio.


