====== Dropbear configuration ======
  * Follow [[docs:guide-user:services:nas:sftp.server|SFTP server]] to provide SFTP support.
  * Follow [[docs:guide-user:security:dropbear.public-key.auth|Dropbear key-based authentication]] to set up key-based authentication.
  * Follow [[docs:guide-user:security:secure.access|Secure your router's access]] for additional security hardening.

The SSH configuration is handled by the [[wp>Dropbear (software)|Dropbear]] subsystem of uci and the configuration file is located in ''/etc/config/dropbear''.

Each dropbear SSH server instance uses a single section of the configuration file, and you can have multiple instances.

===== Sections =====
The ''dropbear'' configuration contains settings for the dropbear SSH server in a single section.

==== Dropbear ====
The ''dropbear'' section contains these settings. Names are case-sensitive.

^ Name ^ Type ^ Required ^ Default ^ Description ^
| ''enable'' | boolean | no | 1 | Set to ''0'' to disable starting dropbear at system boot. |
| ''verbose'' | boolean | no | 0 | Set to ''1'' to enable verbose output by the start script. |
| ''BannerFile'' | string | no | //(none)// | Name of a file to be printed before the user has authenticated successfully. |
| ''PasswordAuth'' | boolean | no | 1 | Set to ''0'' to disable authenticating with passwords. |
| ''Port'' | integer | no | 22 | Port number to listen on. |
| ''RootPasswordAuth'' | boolean | no | 1 | Set to ''0'' to disable authenticating as root with passwords. |
| ''RootLogin'' | boolean | no | 1 | Set to ''0'' to disable SSH logins as root. |
| ''GatewayPorts'' | boolean | no | 0 | Set to ''1'' to allow remote hosts to connect to forwarded ports. |
| ''Interface'' | string | no | //(none)// | Tells dropbear to listen only on the specified interface. (e.g. ''lan'', ''wan'', ''wan6'') |
| ''rsakeyfile'' | file | no | //(none)// | Path to RSA file |
| ''dsskeyfile'' | file | no | //(none)// | Path to DSS/DSA file |
| ''SSHKeepAlive'' | integer | no | 300 | Keep Alive |
| ''IdleTimeout'' | integer | no | 0 | Idle Timeout |
| ''mdns'' | integer | no | 1 | Whether to annouce the service via [[docs:guide-developer:mdns|mDNS]] |
| ''MaxAuthTries'' | integer| no | 3 | Amount of times you can retry writing the password when logging in before the SSH server closes the connection [[https://git.lede-project.org/?p=lede/stintel/staging.git;a=commitdiff;h=eb22143b08f908c15035be563c111cd866638566|from this commit]] |

==== Default configuration ====
This is the default configuration:

<code bash># uci show dropbear
dropbear.@dropbear[0]=dropbear
dropbear.@dropbear[0].RootPasswordAuth='on'
dropbear.@dropbear[0].PasswordAuth='on'
dropbear.@dropbear[0].Port='22'
</code>

===== Extras =====
==== Multiple instances ====
Add a second instance of dropbear listening on port 2022.

<code bash>
uci add dropbear dropbear
uci set dropbear.@dropbear[-1].RootPasswordAuth="on"
uci set dropbear.@dropbear[-1].PasswordAuth="off"
uci set dropbear.@dropbear[-1].Port="2022"
uci commit dropbear
/etc/init.d/dropbear restart
</code>

==== Race conditions ====
Resolve the race condition with netifd service when using interface binding.

<code bash>
cat << "EOF" > /etc/hotplug.d/iface/40-dropbear
if [ "${INTERFACE}" = "wan" ] && [ "${ACTION}" = "ifup" -o "${ACTION}" = "ifupdate" ]
then /etc/init.d/dropbear restart
fi
EOF
</code>

==== Security considerations ====
  * Set up [[docs:guide-user:security:dropbear.public-key.auth|public key authentication]] and disable password authentication if possible.
  * Set up a [[docs:guide-user:services:vpn:start|VPN]] to avoid exposing SSH to the internet and  as a single critical vulnerability may be enough for a remote attacker to gain root access.

Problems facing with a public SSH:
  * No normal group for users and no normal user.
  * No facility to ban IPs with many failed login attempts.
  * File system permissions are very lax on default OpenWrt.
  * Preventing normal users from exploiting busybox to gain access to root only commands due to missing permissions for symlinks.

See also:
  * [[https://matt.ucc.asn.au/dropbear/dropbear.html|Dropbear homepage]]
  * [[https://forum.openwrt.org/viewtopic.php?id=10417|Bruteforce SSH fix]]
